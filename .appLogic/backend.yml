modules:
  rssReader: # Step 1
    location: src/backend/modules/articles/rssReader.js
    event_order:
      - pull_rss_feed
      - parse_rss_feed:
        - channels:
          - url
          - title
        - articles:
          - url
          - title
          - pubDate
          - content:encoded: # RSS feed may contain full article content
            - CDATA HTML content
            - images
            - embedded media
      - store_feeds
      - create_articles_table
    triggers:
      - articles_fetch: 
        with:
          - articles_table:
            - url
            - title
            - pubDate
  articlesFetch: # Step 2
    location: src/backend/modules/articles/articlesFetch.js
    implementation:
      features:
        - Source-specific table handling
        - Bulk article processing
        - Transaction per source
        - Error handling per source
      database:
        operations:
          - UPSERT articles using url as key
          - Transaction management
          - Connection pooling
    tasks:
      - pull articles from Sources
      - store articles:
        - url
        - title
        - date_added
      - check if article scrape needed:
        - if content:encoded exists in RSS:
          - extract and store content
          - skip scraping step
        - else:
          - queue for scraping
    triggers:
      - scrape_articles:
        with:
          - articles_table:
            - url
            - row_id
  articlesScrape: # Step 3
    location: src/backend/modules/articles/articlesScrape.js
    scrapers:
      trueNorth:
        features:
          - Video/Podcast detection
          - Content:encoded extraction
          - Raw content fallback
      cbc:
        features:
          - Custom user agent
          - URL cleaning
          - Main content extraction:
            - main tag parsing
            - detailContent div parsing
            - story-content fallback
    tasks:
      - check scrape_check flag
      - scrape articles only if content is NULL
      - store content in articles_table
    content_processing:
      ollama:
        endpoint: /api/chat
        model: reader-lm:1.5b-fp16
        context_size: 65536
        fallback: "Store original HTML if conversion fails"
    retention:
      articles_days: 30
      events_days: 90
    optimization:
      skip_conditions:
        - content already present
        - video/podcast content

utils:
  logger:
    location: src/backend/utils/logger.js
    implementation: winston
    features:
      - Timestamp
      - Log levels:
          error: "Critical failures and exceptions"
          warn: "Non-critical issues needing attention"
          info: "High-level process starts/completions"
          debug: "Detailed progress tracking"
      - Module-specific loggers
  
  database:
    location: src/backend/utils/dbCon.js
    implementation: pg
    features:
      - Connection pooling
      - Transaction support
      - Parameterized queries
  
  ollama:
    location: src/backend/utils/ollama.js
    implementation: direct-api
    features:
      - Chat API integration
      - Error handling with fallback
      - Request/Response logging
    endpoints:
      chat:
        method: POST
        path: /api/chat
        request:
          - model
          - messages
          - options
        response:
          - message.content