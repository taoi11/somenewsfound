# database.yml

database:
  type: cloudflare_d1
  name: news_analyzer_db
  wrangler_config:
    database_name: "news_db"
    database_id: "${D1_ID}"  # Set in environment variables

  tables:
    sources:
      description: "RSS feed sources"
      columns:
        id:
          type: INTEGER
          primary_key: true
          autoincrement: true
        url:
          type: TEXT
          nullable: false
          unique: true
        channel_name: # non sanitized channel name from the RSS feed
          type: TEXT
          nullable: false
          unique: true
        articles_table: # sanitized channel name for the articles table
          type: TEXT
          nullable: false
          unique: true

    articles_table: # sanitized channel name for the articles table 
      description: "Dynamically created table for each RSS feed source"
      columns:
        id:
          type: INTEGER
          primary_key: true
          autoincrement: true
        title:
          type: TEXT
          nullable: false
        url:
          type: TEXT
          nullable: false
        content:
          type: TEXT
          nullable: true
        summary:
          type: TEXT
          nullable: true
        date_published:
          type: DATE
          nullable: false
        scrape_check:
          type: INTEGER
          nullable: true
        topic_id:
          type: INTEGER
          nullable: true
          references:
            table: news_events
            column: id

    news_events:
      description: "Aggregated news topics and events"
      columns:
        id:
          type: INTEGER
          primary_key: true
          autoincrement: true
        topic_name:
          type: TEXT
          nullable: false
        last_updated:
          type: DATE
          nullable: true
        topic_description:
          type: TEXT
          nullable: true
    
  # Query optimizations
  query_optimization:
    max_articles_per_fetch: 100
    cache_ttl: 3600  # in seconds